import {
  featureCollection,
  lineString,
  multiPolygon,
  point,
  polygon,
} from "@turf/helpers";
import { centralPointsInFeature, polygonEnclosing } from "./GeoTransforms";

describe("GeoTransforms", () => {
  describe("centralPointsInFeatures", () => {
    it("should provide same output for point input", () => {
      expect(centralPointsInFeature(point([0, 0]).geometry))
        .toMatchInlineSnapshot(`
        Object {
          "coordinates": Array [
            0,
            0,
          ],
          "type": "Point",
        }
      `);
    });

    it("should provide point in polygon", () => {
      expect(
        centralPointsInFeature(
          polygon([
            [
              [0, 0],
              [0, 1],
              [1, 1],
              [1, 0],
              [0, 0],
            ],
          ]).geometry
        )
      ).toMatchInlineSnapshot(`
        Object {
          "coordinates": Array [
            0.5,
            0.5,
          ],
          "type": "Point",
        }
      `);
    });

    it("should provide point inside polygon that is not in the hole", () => {
      expect(
        centralPointsInFeature(
          polygon([
            [
              [0, 0],
              [1, 0],
              [1, 1],
              [0, 1],
              [0, 0],
            ],
            [
              [0.25, 0.25],
              [0.25, 0.75],
              [0.75, 0.75],
              [0.75, 0.25],
              [0.25, 0.25],
            ],
          ]).geometry
        )
      ).toMatchInlineSnapshot(`
        Object {
          "coordinates": Array [
            0.25,
            0.49999048070563396,
          ],
          "type": "Point",
        }
      `);
    });

    it("should provide multiple points in multipolygon", () => {
      const firstShape: GeoJSON.Polygon["coordinates"] = [
        [
          [0, 0],
          [0, 1],
          [1, 1],
          [1, 0],
          [0, 0],
        ],
      ];
      const secondShape: GeoJSON.Polygon["coordinates"] = [
        [
          [2, 2],
          [2, 3],
          [3, 3],
          [3, 2],
          [2, 2],
        ],
      ];

      expect(
        centralPointsInFeature(multiPolygon([firstShape, secondShape]).geometry)
      ).toMatchInlineSnapshot(`
        Object {
          "coordinates": Array [
            Array [
              0.5,
              0.5,
            ],
            Array [
              2.5,
              2.5,
            ],
          ],
          "type": "MultiPoint",
        }
      `);
    });
  });
  describe("polygonEnclosing", () => {
    it("should generate a polygon that encloses a feature", () => {
      expect(polygonEnclosing(featureCollection([point([0, 0])])))
        .toMatchInlineSnapshot(`
        Object {
          "coordinates": Array [
            Array [
              Array [
                0.002248300909311345,
                0,
              ],
              Array [
                0.0022374747259208965,
                0.00022037202567503736,
              ],
              Array [
                0.0022051004378128417,
                0.0004386217482784239,
              ],
              Array [
                0.0021514898270764823,
                0.0006526473036769808,
              ],
              Array [
                0.0020771591931953988,
                0.0008603875087763504,
              ],
              Array [
                0.0019828243808015697,
                0.0010598417118407415,
              ],
              Array [
                0.0018693938857007198,
                0.0012490890598626726,
              ],
              Array [
                0.0017379601055616204,
                0.0014263069974274109,
              ],
              Array [
                0.0015897888195299257,
                0.0015897888189179371,
              ],
              Array [
                0.0014263069980835828,
                0.0017379601050231143,
              ],
              Array [
                0.001249089060527517,
                0.0018693938852564857,
              ],
              Array [
                0.0010598417124753918,
                0.0019828243804623415,
              ],
              Array [
                0.0008603875093417542,
                0.0020771591929612003,
              ],
              Array [
                0.0006526473041371119,
                0.0021514898269369026,
              ],
              Array [
                0.0004386217486032649,
                0.0022051004377482268,
              ],
              Array [
                0.00022037202584307102,
                0.002237474725904346,
              ],
              Array [
                -1.0224088830297302e-18,
                0.002248300909311345,
              ],
              Array [
                -0.0002203720258430725,
                0.002237474725904346,
              ],
              Array [
                -0.0004386217486032665,
                0.0022051004377482268,
              ],
              Array [
                -0.0006526473041371139,
                0.002151489826936902,
              ],
              Array [
                -0.0008603875093417553,
                0.0020771591929611994,
              ],
              Array [
                -0.0010598417124753933,
                0.0019828243804623407,
              ],
              Array [
                -0.001249089060527519,
                0.0018693938852564842,
              ],
              Array [
                -0.0014263069980835848,
                0.0017379601050231128,
              ],
              Array [
                -0.0015897888195299265,
                0.0015897888189179352,
              ],
              Array [
                -0.0017379601055616221,
                0.0014263069974274085,
              ],
              Array [
                -0.0018693938857007218,
                0.0012490890598626703,
              ],
              Array [
                -0.0019828243808015706,
                0.001059841711840738,
              ],
              Array [
                -0.0020771591931954,
                0.0008603875087763468,
              ],
              Array [
                -0.002151489827076483,
                0.0006526473036769771,
              ],
              Array [
                -0.0022051004378128426,
                0.00043862174827841947,
              ],
              Array [
                -0.0022374747259208965,
                0.00022037202567503302,
              ],
              Array [
                -0.002248300909311345,
                -4.600839970091605e-18,
              ],
              Array [
                -0.0022374747259208956,
                -0.00022037202567504245,
              ],
              Array [
                -0.0022051004378128413,
                -0.00043862174827842895,
              ],
              Array [
                -0.0021514898270764806,
                -0.000652647303676986,
              ],
              Array [
                -0.0020771591931953966,
                -0.0008603875087763556,
              ],
              Array [
                -0.0019828243808015663,
                -0.0010598417118407467,
              ],
              Array [
                -0.0018693938857007168,
                -0.001249089059862678,
              ],
              Array [
                -0.0017379601055616163,
                -0.0014263069974274158,
              ],
              Array [
                -0.0015897888195299205,
                -0.0015897888189179417,
              ],
              Array [
                -0.001426306998083577,
                -0.0017379601050231187,
              ],
              Array [
                -0.001249089060527512,
                -0.0018693938852564892,
              ],
              Array [
                -0.0010598417124753866,
                -0.001982824380462344,
              ],
              Array [
                -0.0008603875093417491,
                -0.0020771591929612016,
              ],
              Array [
                -0.0006526473041371087,
                -0.002151489826936904,
              ],
              Array [
                -0.00043862174860326243,
                -0.002205100437748228,
              ],
              Array [
                -0.00022037202584306945,
                -0.0022374747259043463,
              ],
              Array [
                1.533613324544595e-18,
                -0.002248300909311345,
              ],
              Array [
                0.0002203720258430725,
                -0.002237474725904346,
              ],
              Array [
                0.0004386217486032649,
                -0.0022051004377482268,
              ],
              Array [
                0.0006526473041371119,
                -0.0021514898269369026,
              ],
              Array [
                0.0008603875093417522,
                -0.0020771591929612007,
              ],
              Array [
                0.0010598417124753894,
                -0.0019828243804623433,
              ],
              Array [
                0.001249089060527515,
                -0.0018693938852564873,
              ],
              Array [
                0.0014263069980835793,
                -0.0017379601050231167,
              ],
              Array [
                0.0015897888195299218,
                -0.0015897888189179404,
              ],
              Array [
                0.0017379601055616172,
                -0.0014263069974274152,
              ],
              Array [
                0.0018693938857007168,
                -0.001249089059862678,
              ],
              Array [
                0.0019828243808015654,
                -0.0010598417118407473,
              ],
              Array [
                0.002077159193195396,
                -0.0008603875087763569,
              ],
              Array [
                0.00215148982707648,
                -0.0006526473036769885,
              ],
              Array [
                0.00220510043781284,
                -0.00043862174827843264,
              ],
              Array [
                0.002237474725920895,
                -0.00022037202567504706,
              ],
              Array [
                0.002248300909311345,
                -1.0479691042986431e-17,
              ],
              Array [
                0.002248300909311345,
                0,
              ],
            ],
          ],
          "type": "Polygon",
        }
      `);
    });

    it("should generate a polygon with a hole that encloses a looped line", () => {
      expect(
        polygonEnclosing(
          featureCollection([
            lineString([
              [0, 0],
              [0, 1],
              [1, 1],
              [1, 0],
              [0, 0],
            ]),
          ])
        )
      ).toMatchInlineSnapshot(`
        Object {
          "coordinates": Array [
            Array [
              Array [
                -0.0022482681685311243,
                -2.8794487172093857e-8,
              ],
              Array [
                -0.0022482723719317167,
                -1.1440131130459163e-7,
              ],
              Array [
                -0.002242860737572081,
                -0.00011021332664581482,
              ],
              Array [
                -0.0022374574889540834,
                -0.00022031266381505375,
              ],
              Array [
                -0.002237444917002254,
                -0.00022039744630272635,
              ],
              Array [
                -0.0022374407092378415,
                -0.00022048305269808095,
              ],
              Array [
                -0.002221263539565646,
                -0.00032952111377067836,
              ],
              Array [
                -0.0022050946749944105,
                -0.0004385604068057873,
              ],
              Array [
                -0.0022050738534128795,
                -0.0004386435485646717,
              ],
              Array [
                -0.0022050612750067105,
                -0.0004387283300948999,
              ],
              Array [
                -0.002178274365263684,
                -0.0005456554312506966,
              ],
              Array [
                -0.002151495599969217,
                -0.0006525845725790706,
              ],
              Array [
                -0.002151466729281322,
                -0.0006526652729085025,
              ],
              Array [
                -0.0021514459013705863,
                -0.0006527484130818835,
              ],
              Array [
                -0.002114307224185159,
                -0.0007565347887028633,
              ],
              Array [
                -0.002077176452564184,
                -0.0008603239924034892,
              ],
              Array [
                -0.002077139810810636,
                -0.0008604014741156507,
              ],
              Array [
                -0.0020771109339794,
                -0.0008604821722472238,
              ],
              Array [
                -0.0020299781553724814,
                -0.0009601283027412137,
              ],
              Array [
                -0.0019828529668906524,
                -0.001059778023125506,
              ],
              Array [
                -0.0019828089069512107,
                -0.0010598515400302648,
              ],
              Array [
                -0.001982772259299622,
                -0.001059929018952488,
              ],
              Array [
                -0.0019260992937445219,
                -0.0011544752580733308,
              ],
              Array [
                -0.0018694335295720108,
                -0.0012490258144170414,
              ],
              Array [
                -0.0018693824757681523,
                -0.001249094658506029,
              ],
              Array [
                -0.0018693384102324248,
                -0.0012491681720558047,
              ],
              Array [
                -0.001803671048961174,
                -0.0013377039888055472,
              ],
              Array [
                -0.0017380104314869056,
                -0.0014262448075748897,
              ],
              Array [
                -0.0017379528754941182,
                -0.0014263083158421001,
              ],
              Array [
                -0.0017379018164498984,
                -0.001426377156044256,
              ],
              Array [
                -0.0016638724719845056,
                -0.0015080499023213847,
              ],
              Array [
                -0.0015898493484238605,
                -0.0015897282877191657,
              ],
              Array [
                -0.001589785844537983,
                -0.0015897858485462196,
              ],
              Array [
                -0.0015897282837112495,
                -0.0015898493524316244,
              ],
              Array [
                -0.001508049898728764,
                -0.0016638724755277368,
              ],
              Array [
                -0.0014263771519513434,
                -0.001737901820357228,
              ],
              Array [
                -0.0014263083117489108,
                -0.0017379528794017696,
              ],
              Array [
                -0.0014262448034817199,
                -0.0017380104353940864,
              ],
              Array [
                -0.0013377039847237296,
                -0.001803671052772696,
              ],
              Array [
                -0.0012491681678883173,
                -0.0018693384140172531,
              ],
              Array [
                -0.0012490946543386586,
                -0.0018693824795529045,
              ],
              Array [
                -0.0012490258102493892,
                -0.0018694335333567901,
              ],
              Array [
                -0.001154475254152406,
                -0.001926099297287456,
              ],
              Array [
                -0.0010599290147180517,
                -0.0019827722629320844,
              ],
              Array [
                -0.0010598515357950467,
                -0.0019828089105838934,
              ],
              Array [
                -0.0010597780188909961,
                -0.001982852970523064,
              ],
              Array [
                -0.0009601282985783543,
                -0.002029978158864623,
              ],
              Array [
                -0.000860482167953729,
                -0.0020771109374211096,
              ],
              Array [
                -0.0008604014698222644,
                -0.0020771398142518673,
              ],
              Array [
                -0.0008603239881100123,
                -0.0020771764560057375,
              ],
              Array [
                -0.0007565347838424613,
                -0.002114307227706218,
              ],
              Array [
                -0.0006527484087403204,
                -0.002151445904575767,
              ],
              Array [
                -0.0006526652685673425,
                -0.0021514667324863184,
              ],
              Array [
                -0.0006525845682375182,
                -0.0021514956031743336,
              ],
              Array [
                -0.0005456554266504232,
                -0.002178274368389319,
              ],
              Array [
                -0.0004387283257218225,
                -0.002205061277923838,
              ],
              Array [
                -0.0004386435441912987,
                -0.0022050738563298175,
              ],
              Array [
                -0.0004385604024326155,
                -0.0022050946779113637,
              ],
              Array [
                -0.000329521109524014,
                -0.00222126354229528,
              ],
              Array [
                -0.00022048304831691907,
                -0.0022374407118111524,
              ],
              Array [
                -0.0002203974419214657,
                -0.0022374449195754686,
              ],
              Array [
                -0.0002203126594340919,
                -0.0022374574915272087,
              ],
              Array [
                -0.0001102133222836161,
                -0.00224286073994906,
              ],
              Array [
                -1.1439695533617069e-7,
                -0.002248272374104923,
              ],
              Array [
                -2.879013130306526e-8,
                -0.0022482681707042284,
              ],
              Array [
                5.681658449178867e-8,
                -0.00224827237195129,
              ],
              Array [
                0.9999999431834155,
                -0.00224827237195129,
              ],
              Array [
                1.0002203233087765,
                -0.002237456443175137,
              ],
              Array [
                1.000438581392983,
                -0.0022050905036122472,
              ],
              Array [
                1.0006526152886202,
                -0.0021514862856376097,
              ],
              Array [
                1.0008603635335387,
                -0.002077160077488926,
              ],
              Array [
                1.001059825205747,
                -0.001982827750636137,
              ],
              Array [
                1.0012490791952129,
                -0.0018693978648750206,
              ],
              Array [
                1.001426302706955,
                -0.001737962917555672,
              ],
              Array [
                1.00158978881722,
                -0.0015897888212277995,
              ],
              Array [
                1.001737962913648,
                -0.0014263027110479655,
              ],
              Array [
                1.00186939786109,
                -0.0012490791993804379,
              ],
              Array [
                1.0019828277470038,
                -0.0010598252099817695,
              ],
              Array [
                1.0020771600740472,
                -0.0008603635378323123,
              ],
              Array [
                1.0021514862824323,
                -0.0006526152929616791,
              ],
              Array [
                1.0022050905006954,
                -0.00043858139735587694,
              ],
              Array [
                1.0022374564406018,
                -0.00022032331315765792,
              ],
              Array [
                1.0022482723697783,
                5.681222832458307e-8,
              ],
              Array [
                1.002248614849018,
                0.9999999424134488,
              ],
              Array [
                1.002237799519454,
                1.0002203012475546,
              ],
              Array [
                1.0022054350464014,
                1.0004385386712642,
              ],
              Array [
                1.0021518330835508,
                1.0006525531427821,
              ],
              Array [
                1.002077509793554,
                1.0008602837853935,
              ],
              Array [
                1.0019831808777118,
                1.001059730232912,
              ],
              Array [
                1.0018697546841748,
                1.0012489718924478,
              ],
              Array [
                1.001738323461009,
                1.0014261864389995,
              ],
              Array [
                1.0015901528383622,
                1.0015896673637754,
              ],
              Array [
                1.0014266696410006,
                1.0017378404072608,
              ],
              Array [
                1.0012494481485805,
                1.0018692787187808,
              ],
              Array [
                1.0010601949359579,
                1.0019827165965776,
              ],
              Array [
                1.0008607324395173,
                1.0020770616760948,
              ],
              Array [
                1.0006529814077734,
                1.002151405449085,
              ],
              Array [
                1.0004389424052378,
                1.0022050320122564,
              ],
              Array [
                1.0002206765476653,
                1.0022374249612007,
              ],
              Array [
                1.0000002856541965,
                1.0022482723632198,
              ],
              Array [
                -2.8565419658180734e-7,
                1.0022482723632198,
              ],
              Array [
                -0.0002206765476652673,
                1.0022374249612007,
              ],
              Array [
                -0.00043894240523766244,
                1.0022050320122564,
              ],
              Array [
                -0.0006529814077732589,
                1.002151405449085,
              ],
              Array [
                -0.0008607324395173343,
                1.0020770616760948,
              ],
              Array [
                -0.001060194935957953,
                1.0019827165965776,
              ],
              Array [
                -0.0012494481485804479,
                1.0018692787187808,
              ],
              Array [
                -0.0014266696410006098,
                1.0017378404072608,
              ],
              Array [
                -0.0015901528383620424,
                1.0015896673637754,
              ],
              Array [
                -0.001738323461009049,
                1.0014261864389995,
              ],
              Array [
                -0.0018697546841748255,
                1.0012489718924478,
              ],
              Array [
                -0.001983180877711708,
                1.001059730232912,
              ],
              Array [
                -0.0020775097935539005,
                1.0008602837853935,
              ],
              Array [
                -0.002151833083550699,
                1.0006525531427821,
              ],
              Array [
                -0.002205435046401267,
                1.0004385386712642,
              ],
              Array [
                -0.0022377995194541533,
                1.0002203012475546,
              ],
              Array [
                -0.002248614849017842,
                0.9999999424134488,
              ],
              Array [
                -0.0022482723697783815,
                5.681222832458307e-8,
              ],
              Array [
                -0.0022482681685311243,
                -2.8794487172093857e-8,
              ],
            ],
            Array [
              Array [
                0.002248386519971377,
                0.0022483865247401036,
              ],
              Array [
                0.002248727459200275,
                0.9977519551367092,
              ],
              Array [
                0.9977512725407996,
                0.9977519551367092,
              ],
              Array [
                0.9977516134800287,
                0.0022483865247401036,
              ],
              Array [
                0.002248386519971377,
                0.0022483865247401036,
              ],
            ],
          ],
          "type": "Polygon",
        }
      `);
    });

    it("should generate multipolygon that encloses two distant features", () => {
      expect(
        polygonEnclosing(featureCollection([point([0, 0]), point([1, 1])]))
      ).toMatchInlineSnapshot(`
        Object {
          "coordinates": Array [
            Array [
              Array [
                Array [
                  -0.002248300909311345,
                  0,
                ],
                Array [
                  -0.0022374747259208956,
                  -0.00022037202567504245,
                ],
                Array [
                  -0.0022051004378128413,
                  -0.00043862174827842895,
                ],
                Array [
                  -0.0021514898270764806,
                  -0.000652647303676986,
                ],
                Array [
                  -0.0020771591931953966,
                  -0.0008603875087763556,
                ],
                Array [
                  -0.0019828243808015663,
                  -0.0010598417118407467,
                ],
                Array [
                  -0.0018693938857007168,
                  -0.001249089059862678,
                ],
                Array [
                  -0.0017379601055616163,
                  -0.0014263069974274158,
                ],
                Array [
                  -0.0015897888195299205,
                  -0.0015897888189179417,
                ],
                Array [
                  -0.001426306998083577,
                  -0.0017379601050231187,
                ],
                Array [
                  -0.001249089060527512,
                  -0.0018693938852564892,
                ],
                Array [
                  -0.0010598417124753866,
                  -0.001982824380462344,
                ],
                Array [
                  -0.0008603875093417491,
                  -0.0020771591929612016,
                ],
                Array [
                  -0.0006526473041371087,
                  -0.002151489826936904,
                ],
                Array [
                  -0.00043862174860326243,
                  -0.002205100437748228,
                ],
                Array [
                  -0.00022037202584306945,
                  -0.0022374747259043463,
                ],
                Array [
                  0,
                  -0.002248300909311345,
                ],
                Array [
                  0.0002203720258430725,
                  -0.0022374747259043463,
                ],
                Array [
                  0.0004386217486032649,
                  -0.0022051004377482268,
                ],
                Array [
                  0.0006526473041371119,
                  -0.0021514898269369026,
                ],
                Array [
                  0.0008603875093417522,
                  -0.0020771591929612007,
                ],
                Array [
                  0.0010598417124753894,
                  -0.0019828243804623433,
                ],
                Array [
                  0.001249089060527515,
                  -0.0018693938852564873,
                ],
                Array [
                  0.0014263069980835793,
                  -0.0017379601050231167,
                ],
                Array [
                  0.0015897888195299218,
                  -0.0015897888189179404,
                ],
                Array [
                  0.0017379601055616172,
                  -0.0014263069974274152,
                ],
                Array [
                  0.0018693938857007168,
                  -0.001249089059862678,
                ],
                Array [
                  0.0019828243808015654,
                  -0.0010598417118407473,
                ],
                Array [
                  0.002077159193195396,
                  -0.0008603875087763569,
                ],
                Array [
                  0.00215148982707648,
                  -0.0006526473036769885,
                ],
                Array [
                  0.00220510043781284,
                  -0.00043862174827843264,
                ],
                Array [
                  0.002237474725920895,
                  -0.00022037202567504706,
                ],
                Array [
                  0.002248300909311345,
                  0,
                ],
                Array [
                  0.0022374747259208965,
                  0.00022037202567503736,
                ],
                Array [
                  0.0022051004378128417,
                  0.0004386217482784239,
                ],
                Array [
                  0.0021514898270764823,
                  0.0006526473036769808,
                ],
                Array [
                  0.0020771591931953988,
                  0.0008603875087763504,
                ],
                Array [
                  0.0019828243808015697,
                  0.0010598417118407415,
                ],
                Array [
                  0.0018693938857007198,
                  0.0012490890598626726,
                ],
                Array [
                  0.0017379601055616204,
                  0.0014263069974274109,
                ],
                Array [
                  0.0015897888195299257,
                  0.0015897888189179371,
                ],
                Array [
                  0.0014263069980835828,
                  0.0017379601050231143,
                ],
                Array [
                  0.001249089060527517,
                  0.0018693938852564857,
                ],
                Array [
                  0.0010598417124753918,
                  0.0019828243804623415,
                ],
                Array [
                  0.0008603875093417542,
                  0.0020771591929612003,
                ],
                Array [
                  0.0006526473041371119,
                  0.0021514898269369026,
                ],
                Array [
                  0.0004386217486032649,
                  0.0022051004377482268,
                ],
                Array [
                  0.00022037202584307102,
                  0.002237474725904346,
                ],
                Array [
                  0,
                  0.002248300909311345,
                ],
                Array [
                  -0.0002203720258430725,
                  0.002237474725904346,
                ],
                Array [
                  -0.0004386217486032665,
                  0.0022051004377482268,
                ],
                Array [
                  -0.0006526473041371139,
                  0.0021514898269369026,
                ],
                Array [
                  -0.0008603875093417553,
                  0.0020771591929611994,
                ],
                Array [
                  -0.0010598417124753933,
                  0.0019828243804623407,
                ],
                Array [
                  -0.001249089060527519,
                  0.0018693938852564842,
                ],
                Array [
                  -0.0014263069980835848,
                  0.0017379601050231128,
                ],
                Array [
                  -0.0015897888195299265,
                  0.0015897888189179352,
                ],
                Array [
                  -0.0017379601055616221,
                  0.0014263069974274085,
                ],
                Array [
                  -0.0018693938857007218,
                  0.0012490890598626703,
                ],
                Array [
                  -0.0019828243808015706,
                  0.001059841711840738,
                ],
                Array [
                  -0.0020771591931954,
                  0.0008603875087763468,
                ],
                Array [
                  -0.002151489827076483,
                  0.0006526473036769771,
                ],
                Array [
                  -0.0022051004378128426,
                  0.00043862174827841947,
                ],
                Array [
                  -0.0022374747259208965,
                  0.00022037202567503302,
                ],
                Array [
                  -0.002248300909311345,
                  0,
                ],
              ],
            ],
            Array [
              Array [
                Array [
                  0.9977513566114095,
                  0.9999999992300231,
                ],
                Array [
                  0.9977621845941691,
                  0.9997796272117455,
                ],
                Array [
                  0.9977945639582535,
                  0.9995613775110502,
                ],
                Array [
                  0.9978481828685283,
                  0.9993473519912285,
                ],
                Array [
                  0.9979225249417467,
                  0.9991396118340076,
                ],
                Array [
                  0.998016874219749,
                  0.9989401576892829,
                ],
                Array [
                  0.9981303220646596,
                  0.9987509104078204,
                ],
                Array [
                  0.998261775909672,
                  0.9985736925424767,
                ],
                Array [
                  0.9984099697811429,
                  0.9984102107960937,
                ],
                Array [
                  0.9985734764906581,
                  0.9982620395850961,
                ],
                Array [
                  0.9987507213796532,
                  0.9981306058770839,
                ],
                Array [
                  0.9989399974842194,
                  0.9980171754484375,
                ],
                Array [
                  0.9991394819740504,
                  0.9979228406942784,
                ],
                Array [
                  0.9993472537072168,
                  0.9978485101081809,
                ],
                Array [
                  0.9995613117317058,
                  0.9977948995329462,
                ],
                Array [
                  0.9997795945555552,
                  0.9977625252666982,
                ],
                Array [
                  1,
                  0.9977516990906887,
                ],
                Array [
                  1.0002204054444448,
                  0.9977625252666982,
                ],
                Array [
                  1.0004386882682943,
                  0.9977948995329462,
                ],
                Array [
                  1.0006527462927832,
                  0.9978485101081809,
                ],
                Array [
                  1.0008605180259496,
                  0.9979228406942784,
                ],
                Array [
                  1.0010600025157808,
                  0.9980171754484375,
                ],
                Array [
                  1.0012492786203468,
                  0.9981306058770839,
                ],
                Array [
                  1.001426523509342,
                  0.9982620395850961,
                ],
                Array [
                  1.001590030218857,
                  0.9984102107960937,
                ],
                Array [
                  1.001738224090328,
                  0.9985736925424767,
                ],
                Array [
                  1.0018696779353404,
                  0.9987509104078204,
                ],
                Array [
                  1.001983125780251,
                  0.9989401576892829,
                ],
                Array [
                  1.0020774750582533,
                  0.9991396118340076,
                ],
                Array [
                  1.0021518171314718,
                  0.9993473519912285,
                ],
                Array [
                  1.0022054360417465,
                  0.9995613775110502,
                ],
                Array [
                  1.002237815405831,
                  0.9997796272117455,
                ],
                Array [
                  1.0022486433885907,
                  0.9999999992300231,
                ],
                Array [
                  1.0022378157063068,
                  1.0002203712630955,
                ],
                Array [
                  1.0022054366311512,
                  1.0004386210076066,
                ],
                Array [
                  1.0021518179871545,
                  1.000652646598582,
                ],
                Array [
                  1.0020774761473308,
                  1.0008603868515598,
                ],
                Array [
                  1.0019831270608708,
                  1.001059841112964,
                ],
                Array [
                  1.001869679358289,
                  1.0012490885275454,
                ],
                Array [
                  1.0017382256009222,
                  1.0014263065373312,
                ],
                Array [
                  1.0015900317590454,
                  1.001589788433929,
                ],
                Array [
                  1.0014265250199361,
                  1.0017379597951421,
                ],
                Array [
                  1.0012492800432955,
                  1.0018693936475966,
                ],
                Array [
                  1.0010600037964006,
                  1.001982824209362,
                ],
                Array [
                  1.0008605191150273,
                  1.0020771590802007,
                ],
                Array [
                  1.000652747148466,
                  1.0021514897620545,
                ],
                Array [
                  1.0004386888576986,
                  1.0022051004084425,
                ],
                Array [
                  1.0002204057449209,
                  1.002237474718507,
                ],
                Array [
                  1,
                  1.0022483009093113,
                ],
                Array [
                  0.9997795942550792,
                  1.002237474718507,
                ],
                Array [
                  0.9995613111423014,
                  1.0022051004084425,
                ],
                Array [
                  0.9993472528515339,
                  1.0021514897620545,
                ],
                Array [
                  0.9991394808849727,
                  1.0020771590802007,
                ],
                Array [
                  0.9989399962035994,
                  1.001982824209362,
                ],
                Array [
                  0.9987507199567046,
                  1.0018693936475966,
                ],
                Array [
                  0.998573474980064,
                  1.0017379597951421,
                ],
                Array [
                  0.9984099682409546,
                  1.001589788433929,
                ],
                Array [
                  0.9982617743990779,
                  1.0014263065373312,
                ],
                Array [
                  0.9981303206417109,
                  1.0012490885275454,
                ],
                Array [
                  0.9980168729391292,
                  1.001059841112964,
                ],
                Array [
                  0.9979225238526692,
                  1.0008603868515598,
                ],
                Array [
                  0.9978481820128455,
                  1.000652646598582,
                ],
                Array [
                  0.9977945633688489,
                  1.0004386210076066,
                ],
                Array [
                  0.9977621842936931,
                  1.0002203712630955,
                ],
                Array [
                  0.9977513566114095,
                  0.9999999992300231,
                ],
              ],
            ],
          ],
          "type": "MultiPolygon",
        }
      `);
    });

    it("should generate polygon that encloses two nearby features", () => {
      expect(
        polygonEnclosing(
          featureCollection([point([0, 0]), point([0.00001, 0.00001])])
        )
      ).toMatchInlineSnapshot(`
        Object {
          "coordinates": Array [
            Array [
              Array [
                -0.002248300909311345,
                0,
              ],
              Array [
                -0.0022374747259208956,
                -0.00022037202567504245,
              ],
              Array [
                -0.0022051004378128413,
                -0.00043862174827842895,
              ],
              Array [
                -0.0021514898270764806,
                -0.000652647303676986,
              ],
              Array [
                -0.0020771591931953966,
                -0.0008603875087763556,
              ],
              Array [
                -0.0019828243808015663,
                -0.0010598417118407467,
              ],
              Array [
                -0.0018693938857007168,
                -0.001249089059862678,
              ],
              Array [
                -0.0017379601055616163,
                -0.0014263069974274158,
              ],
              Array [
                -0.0015897888195299205,
                -0.0015897888189179417,
              ],
              Array [
                -0.001426306998083577,
                -0.0017379601050231187,
              ],
              Array [
                -0.001249089060527512,
                -0.0018693938852564892,
              ],
              Array [
                -0.0010598417124753866,
                -0.001982824380462344,
              ],
              Array [
                -0.0008603875093417491,
                -0.0020771591929612016,
              ],
              Array [
                -0.0006526473041371087,
                -0.002151489826936904,
              ],
              Array [
                -0.00043862174860326243,
                -0.002205100437748228,
              ],
              Array [
                -0.00022037202584306945,
                -0.0022374747259043463,
              ],
              Array [
                0,
                -0.002248300909311345,
              ],
              Array [
                0.0002203720258430725,
                -0.0022374747259043463,
              ],
              Array [
                0.0004386217486032649,
                -0.0022051004377482268,
              ],
              Array [
                0.0006526473041371119,
                -0.0021514898269369026,
              ],
              Array [
                0.0008603875093417522,
                -0.0020771591929612007,
              ],
              Array [
                0.0010598417124753894,
                -0.0019828243804623433,
              ],
              Array [
                0.001249089060527515,
                -0.0018693938852564873,
              ],
              Array [
                0.0014263069980835793,
                -0.0017379601050231167,
              ],
              Array [
                0.0015897888195299218,
                -0.0015897888189179404,
              ],
              Array [
                0.0015945431852774062,
                -0.0015845431846709336,
              ],
              Array [
                0.0015997888195222467,
                -0.0015797888189217897,
              ],
              Array [
                0.0017479601055540924,
                -0.0014163069974320157,
              ],
              Array [
                0.001879393885693632,
                -0.0012390890598680008,
              ],
              Array [
                0.001992824380795194,
                -0.0010498417118467356,
              ],
              Array [
                0.002087159193189984,
                -0.0008503875087829284,
              ],
              Array [
                0.0021614898270722357,
                -0.0006426473036840387,
              ],
              Array [
                0.0022151004378099274,
                -0.0004286217482858385,
              ],
              Array [
                0.0022474747259194276,
                -0.00021037202568267206,
              ],
              Array [
                0.002258300909311379,
                0.000009999999992301013,
              ],
              Array [
                0.0022474747259224326,
                0.00023037202566741232,
              ],
              Array [
                0.0022151004378158216,
                0.00044862174827101786,
              ],
              Array [
                0.0021614898270807923,
                0.0006626473036699306,
              ],
              Array [
                0.002087159193200875,
                0.0008703875087697788,
              ],
              Array [
                0.0019928243808080013,
                0.0010698417118347534,
              ],
              Array [
                0.001879393885707861,
                0.0012590890598573499,
              ],
              Array [
                0.0017479601055691977,
                0.0014363069974228104,
              ],
              Array [
                0.0015997888195376489,
                0.0015997888189140874,
              ],
              Array [
                0.0014363069980911553,
                0.0017479601050200161,
              ],
              Array [
                0.0012590890605346486,
                0.0018793938852541094,
              ],
              Array [
                0.0010698417124818094,
                0.0019928243804606307,
              ],
              Array [
                0.0008703875093472114,
                0.002087159192960073,
              ],
              Array [
                0.0006626473041413991,
                0.0021614898269362542,
              ],
              Array [
                0.00044862174860621794,
                0.002215100437747934,
              ],
              Array [
                0.00023037202584457635,
                0.0022474747259042718,
              ],
              Array [
                0.00000999999999999898,
                0.002258300909311345,
              ],
              Array [
                -0.00021037202584457785,
                0.0022474747259042718,
              ],
              Array [
                -0.00042862174860621946,
                0.002215100437747934,
              ],
              Array [
                -0.0006426473041414011,
                0.0021614898269362542,
              ],
              Array [
                -0.0008503875093472124,
                0.0020871591929600723,
              ],
              Array [
                -0.001049841712481811,
                0.00199282438046063,
              ],
              Array [
                -0.001239089060534651,
                0.001879393885254108,
              ],
              Array [
                -0.0014163069980911575,
                0.0017479601050200144,
              ],
              Array [
                -0.0015797888195376497,
                0.0015997888189140854,
              ],
              Array [
                -0.0015845431852851036,
                0.001594543184667083,
              ],
              Array [
                -0.0015897888195299265,
                0.0015897888189179352,
              ],
              Array [
                -0.0017379601055616221,
                0.0014263069974274085,
              ],
              Array [
                -0.0018693938857007218,
                0.0012490890598626703,
              ],
              Array [
                -0.0019828243808015706,
                0.001059841711840738,
              ],
              Array [
                -0.0020771591931954,
                0.0008603875087763468,
              ],
              Array [
                -0.002151489827076483,
                0.0006526473036769771,
              ],
              Array [
                -0.0022051004378128426,
                0.00043862174827841947,
              ],
              Array [
                -0.0022374747259208965,
                0.00022037202567503302,
              ],
              Array [
                -0.002248300909311345,
                0,
              ],
            ],
          ],
          "type": "Polygon",
        }
      `);
    });
  });
});
